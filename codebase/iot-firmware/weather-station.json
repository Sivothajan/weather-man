{
  "name": "weather-station",
  "type": "ino",
  "files": [
    {
      "name": "weather-station.ino",
      "content": "#include <DHT.h>\n#include <LiquidCrystal_I2C.h>\n#include <SoftwareSerial.h>\n#include <SPI.h>\n#include <SD.h>\n\n// ----- Constants & Pins -----\n#define DHTPIN 2\n#define DHTTYPE DHT11\n#define SOIL_PIN A0\n#define RAIN_PIN A1\n#define SD_CS 10\n\n// ----- Objects -----\nDHT dht(DHTPIN, DHTTYPE);\nLiquidCrystal_I2C lcd(0x27, 16, 2); // I2C LCD\nSoftwareSerial espSerial(3, 4);     // ESP-01 TX/RX\n\n// ----- WiFi & API -----\nconst char* ssid = \"Your_SSID\";\nconst char* password = \"Your_PASSWORD\";\nconst char* apiHost = \"yourapi.com\";\nconst char* apiPath = \"/weather/upload\";\n\n// ----- Setup -----\nvoid setup() {\n  Serial.begin(9600);\n  espSerial.begin(9600);\n\n  dht.begin();\n  lcd.begin(16, 2);\n  lcd.backlight();\n\n  lcd.print(\"Weather Man\");\n  delay(2000);\n  lcd.clear();\n\n  if (!SD.begin(SD_CS)) {\n    Serial.println(\"SD init failed!\");\n  }\n\n  connectWiFi();\n}\n\n// ----- Main Loop -----\nvoid loop() {\n  float temp = dht.readTemperature();\n  float humid = dht.readHumidity();\n  int soilRaw = analogRead(SOIL_PIN);\n  int rainRaw = analogRead(RAIN_PIN);\n\n  int soil = map(soilRaw, 1023, 0, 0, 100);\n  bool rain = rainRaw < 500;\n\n  // LCD Output\n  lcd.setCursor(0, 0);\n  lcd.print(\"T:\");\n  lcd.print(temp);\n  lcd.print(\"C H:\");\n  lcd.print(humid);\n  lcd.setCursor(0, 1);\n  lcd.print(\"S:\");\n  lcd.print(soil);\n  lcd.print(\"% \");\n  lcd.print(rain ? \"Rain\" : \"Dry \");\n\n  // Serial Debug\n  Serial.print(\"T: \"); Serial.print(temp);\n  Serial.print(\" H: \"); Serial.print(humid);\n  Serial.print(\" Soil: \"); Serial.print(soil);\n  Serial.print(\" Rain: \"); Serial.println(rain);\n\n  logToSD(temp, humid, soil, rain);\n  sendToAPI(temp, humid, soil, rain);\n\n  delay(10000); // 10 seconds\n}\n\n// ----- SD Logging -----\nvoid logToSD(float temp, float humid, int soil, bool rain) {\n  File file = SD.open(\"datalog.txt\", FILE_WRITE);\n  if (file) {\n    file.print(\"T:\"); file.print(temp);\n    file.print(\", H:\"); file.print(humid);\n    file.print(\", Soil:\"); file.print(soil);\n    file.print(\", Rain:\"); file.println(rain ? \"1\" : \"0\");\n    file.close();\n  } else {\n    Serial.println(\"SD log failed.\");\n  }\n}\n\n// ----- WiFi Connect -----\nvoid connectWiFi() {\n  espSerial.println(\"AT+CWMODE=1\");\n  delay(2000);\n  espSerial.print(\"AT+CWJAP=\\\"\");\n  espSerial.print(ssid);\n  espSerial.print(\"\\\",\\\"\");\n  espSerial.print(password);\n  espSerial.println(\"\\\"\");\n  delay(8000);\n}\n\n// ----- API Call (JSON POST) -----\nvoid sendToAPI(float temp, float humid, int soil, bool rain) {\n  String json = \"{\";\n  json += \"\\\"temperature\\\":\" + String(temp, 2) + \",\";\n  json += \"\\\"humidity\\\":\" + String(humid, 2) + \",\";\n  json += \"\\\"soil_moisture\\\":\" + String(soil) + \",\";\n  json += \"\\\"rain\\\":\" + String(rain ? 1 : 0);\n  json += \"}\";\n\n  int len = json.length();\n\n  espSerial.println(\"AT+CIPSTART=\\\"TCP\\\",\\\"\" + String(apiHost) + \"\\\",80\");\n  delay(3000);\n\n  String req = \"POST \" + String(apiPath) + \" HTTP/1.1\\r\\n\";\n  req += \"Host: \" + String(apiHost) + \"\\r\\n\";\n  req += \"Content-Type: application/json\\r\\n\";\n  req += \"Content-Length: \" + String(len) + \"\\r\\n\";\n  req += \"Connection: close\\r\\n\\r\\n\";\n  req += json;\n\n  espSerial.print(\"AT+CIPSEND=\");\n  espSerial.println(req.length());\n  delay(1000);\n\n  espSerial.print(req);\n  delay(2000);\n  espSerial.println(\"AT+CIPCLOSE\");\n}"
    }
  ]
}
